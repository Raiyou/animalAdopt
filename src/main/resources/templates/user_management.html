<!DOCTYPE html>
<html>
<head>
    <title>會員資料變更</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <!-- 禁用官方樣式 使用 Bootstrap 自帶樣式
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    -->
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="css/jquery.timepicker.css">
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/style.css">
    <!-- 全域自訂CSS樣式 -->
    <link rel="stylesheet" href="css/_custom.css">
    <!--  自訂樣式  -->
    <style>
        /*按鈕樣式*/
        .btn.btn-primary {
            color: black !important;
            padding: 6px 20px;
            font-size: 1rem;
            letter-spacing: 1px;
            border: transparent !important;
            background: #fcd601 !important;
            opacity: 1;
        }

        /*按鈕樣式-滑鼠掠過*/
        .btn.btn-primary:hover {
            color: white !important;
            background: #ffa500 !important;
            outline: 1px solid;
            opacity: 1;
        }

        /*註冊登入區輸入框、按鈕、下拉選單字體加大、邊角圓弧加大*/
        .form-group input,
        .form-group button,
        .form-group select {
            font-size: 20px !important;
            border-radius: 0.5rem;
        }

        /*區塊標題樣式*/
        h2 {
            color: black !important;
            font-weight: bolder !important;
        }

        /*ICON 自訂樣式*/
        .fa-icon {
            color: black;
            background: lightgrey;
            text-align: center;
            padding: 0.5rem 1rem;
            min-width: 13%;
            border-top-left-radius: 0.5rem !important;
            border-bottom-left-radius: 0.5em !important;
        }

        /*資料類型樣式*/
        h5 {
            color: black;
            background: lightgrey;
            text-align: center !important;
            width: 60px;
            height: 52px;
            /*padding: 0.5rem 1rem;*/
            border-top-left-radius: 0.5rem !important;
            border-bottom-left-radius: 0.5em !important;
            border-right: 1px dotted grey;
            flex-shrink: 0;
        }

        /*資料類型鄰近輸入區邊角取消圓弧效果*/
        h5 + input, h5 + select,
        span + input, span + select {
            border-radius: 0 0.5rem 0.5rem 0 !important;
        }
    </style>
</head>

<body>
<div id="header-page"></div>

<section class="ftco-section main-img">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-6 half p-5 ftco-animate">
                <h2 class="mb-3">基本會員資料</h2>
                <div class="row">
                    <div class="col-12">
                        <div class="form-group d-flex">
                            <h5 class="d-flex text-center align-items-center font-weight-bold p-2">帳號</h5>
                            <input id="userEmail" type="email" class="form-control" placeholder="電子郵件"
                                   style="background-color: lightgrey !important; cursor: default;" readonly>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group d-flex">
                            <h5 class="d-flex text-center align-items-center font-weight-bold p-2">姓名</h5>
                            <input id="userName" type="text" class="form-control" placeholder="姓名">
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group d-flex">
                            <h5 class="d-flex text-center align-items-center font-weight-bold p-2">性別</h5>
<!--                            <input id="userGender" type="text" class="form-control" placeholder="性別"-->
<!--                                   style="background-color: lightgrey !important; cursor: default;" readonly>-->
                            <select id="userGender" class="custom-select" type="text"
                                    style="height: 52px !important;">
                                <option value="男">男</option>
                                <option value="女">女</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group d-flex">
                            <h5 class="d-flex text-center align-items-center font-weight-bold p-2">電話</h5>
                            <input id="userTel" type="tel" class="form-control" placeholder="聯絡電話">
                        </div>
                    </div>
                    <div id="editPwdDiv" class="col-md-12 ftco-animate" style="display: none">
                        <div class="form-group d-flex">
                            <span class="fa-icon"><i class="fa fa-key fa-2x"></i></span>
<!--                            <h5 class="d-flex text-center align-items-center font-weight-bold p-2">密碼</h5>-->
                            <input id="editPwd" type="password" class="form-control" placeholder="輸入新密碼">
                        </div>
                    </div>
                    <div id="editPwdConfirmDiv" class="col-md-12 ftco-animate" style="display: none">
                        <div class="form-group d-flex">
                            <span class="fa-icon"><i class="fa fa-key fa-2x"></i></span>
<!--                            <h5 class="d-flex text-center align-items-center font-weight-bold p-2">確認</h5>-->
                            <input id="editPwdConfirm" type="password" class="form-control" placeholder="確認新密碼">
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group d-flex justify-content-center">
                            <button id="editPwdBtn" class="btn btn-primary mx-1 ftco-animate" onclick="editPwdBtn()">
                                密碼變更
                            </button>
                            <button id="cancelPwdBtn" class="btn btn-primary mx-1 ftco-animate" style="display: none;"
                                    onclick="cancelPwdBtn()">取消
                            </button>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group d-flex">
                            <span class="fa-icon"><i class="fa fa-address-card-o fa-2x"></i></span>
<!--                            <h5 class="d-flex text-center align-items-center font-weight-bold p-2">驗證</h5>-->
                            <input id="userPwdCheck" type="password" class="form-control"
                                   placeholder="輸入目前密碼進行驗證">
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <button onclick="editSubmit()" class="form-control btn btn-primary py-1 px-4">變更
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 頁腳 -->
<div id="footer-page"></div>


<!-- 頁面載入動畫 -->
<div id="ftco-loader" class="show fullscreen">
    <svg class="circular" width="48px" height="48px">
        <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/>
        <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
                stroke="#F96D00"/>
    </svg>
</div>


<script src="js/jquery.min.js"></script>
<script src="js/jquery-migrate-3.0.1.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.easing.1.3.js"></script>
<script src="js/jquery.waypoints.min.js"></script>
<script src="js/jquery.stellar.min.js"></script>
<script src="js/jquery.animateNumber.min.js"></script>
<script src="js/bootstrap-datepicker.js"></script>
<script src="js/jquery.timepicker.min.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script src="js/jquery.magnific-popup.min.js"></script>
<script src="js/scrollax.min.js"></script>
<script src="js/main.js"></script>
<script src="js/_animal-init.js"></script>
<script>

    // 初始化將會員資料帶入表單
    $("#userEmail").val(user.email);
    $("#userName").val(user.name);
    $("#userTel").val(user.tel);
    // 初始化密碼欄位清空
    $("#editPwd").val("");
    $("#editPwdConfirm").val("");
    $("#userPwdCheck").val("");
    // 性別下拉選單初始化
    $("#userGender option").removeAttr("selected");
    // 變更性別 select 外觀選取項目
    $("#userGender").val(`${user.gender}`).change();
    // 變更性別 option 實際選取項目
    $(`#userGender option[value='${user.gender}']`).attr("selected", "selected");




    function editSubmit() {

        var name = $("#userName").val();
        var gender = $("#userGender").val();
        var tel = $("#userTel").val();
        var editPasswd = $("#editPwd").val();
        var editPasswdConfirm = $("#editPwdConfirm").val();
        var pwdCheck = $("#userPwdCheck").val();

        // 此判斷允許 新密碼兩欄位均為空值 或 新密碼兩欄位均為一致
        if (pwdCheck == "") {
            // 驗證密碼為空值
            alert("請填寫驗證密碼!");
            return
        } else if (name == "" || gender == "" || tel == "" ) {
            // 基本資料存在空值
            alert("請填寫所有基本資料!");
            return
        } else if (editPasswd != editPasswdConfirm && (editPasswd != "" || editPasswdConfirm != "")) {
            // 新密碼欄位有值但不一致
            alert("新密碼不一致!");
            return
        }

        console.log("會員Id: " + user.id);

        // 新密碼及新密碼確認均為空值 = 沒有修改密碼 只修改基本資料
        if (editPasswd == "" && editPasswdConfirm == "") {

            $.ajax({
                type: "PUT",
                url: "/user/" + user.id,
                contentType: "application/json; charset=UTF-8",
                data:
                    JSON.stringify({
                        "name": name,
                        "gender": gender,
                        "tel": tel,
                        "password": pwdCheck
                    }),
                success: function (data) {
                    console.log(data);
                    switch (data) {
                        case "1":
                            alert("修改成功! 請重新登入");
                            signOutRedirect();
                            break
                        case "2":
                            alert("修改成功! 請使用新密碼登入");
                            signOutRedirect();
                            break
                        case "0":
                            alert("密碼錯誤!");
                            break
                    }
                }
            });

            console.log("沒有修改密碼")

            // 新密碼及新密碼確認均為一致 = 有修改密碼
        } else if (editPasswd == editPasswdConfirm) {
            $.ajax({
                type: "PUT",
                url: "/user/" + user.id,
                contentType: "application/json; charset=UTF-8",
                data:
                    JSON.stringify({
                        "name": name,
                        "gender": gender,
                        "tel": tel,
                        "editPassword": editPasswd,
                        "password": pwdCheck
                    }),
                success: function (data) {
                    console.log(data);
                    switch (data) {
                        case "1":
                            alert("修改成功! 請重新登入");
                            signOutRedirect();
                            break
                        case "2":
                            alert("修改成功! 請使用新密碼登入");
                            signOutRedirect();
                            break
                        case "0":
                            alert("密碼錯誤!");
                            break
                    }
                }
            });
        }
    }

    function editPwdBtn() {
        // 按鈕顯示切換
        $("#editPwdBtn").attr("style", "display: none")
        $("#cancelPwdBtn").attr("style", "display: inline")
        // 密碼欄位清空
        $("#editPwd").val("");
        $("#editPwdConfirm").val("");
        // 密碼 div 區塊顯示
        $("#editPwdDiv").attr("style", "display: inline")
        $("#editPwdConfirmDiv").attr("style", "display: inline")
    }

    function cancelPwdBtn() {
        // 按鈕顯示切換
        $("#editPwdBtn").attr("style", "display: inline")
        $("#cancelPwdBtn").attr("style", "display: none")
        // 密碼欄位清空
        $("#editPwd").val("");
        $("#editPwdConfirm").val("");
        // 密碼 div 區塊隱藏
        $("#editPwdDiv").attr("style", "display: none")
        $("#editPwdConfirmDiv").attr("style", "display: none")
    }

</script>

</body>
</html>