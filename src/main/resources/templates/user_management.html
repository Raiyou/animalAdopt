<!DOCTYPE html>
<html>
<head>
    <title>會員資料變更</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <!-- 禁用官方樣式 使用 Bootstrap 自帶樣式
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    -->
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="css/jquery.timepicker.css">
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/style.css">
    <!-- 全域自訂CSS樣式 -->
    <link rel="stylesheet" href="css/_custom.css">
    <!--  自訂樣式  -->
    <style>
        /*按鈕樣式*/
        .btn.btn-primary {
            color: black !important;
            padding: 6px 20px;
            font-size: 1rem;
            letter-spacing: 1px;
            border: transparent !important;
            background: #fcd601 !important;
            opacity: 1;
        }

        /*按鈕樣式-滑鼠掠過*/
        .btn.btn-primary:hover {
            color: white !important;
            background: #ffa500 !important;
            opacity: 1;
        }

        /*註冊登入區輸入框、按鈕、下拉選單字體加大、邊角圓弧加大*/
        .form-group input,
        .form-group button,
        .form-group select {
            font-size: 20px !important;
            border-radius: 0.5rem;
        }

        /*ICON 鄰近輸入區邊角取消圓弧效果*/
        span + input, span + select {
            border-radius: 0 0.5rem 0.5rem 0 !important;
        }

        /*ICON 自訂樣式*/
        .fa-icon {
            color: black;
            background: lightgrey;
            text-align: center;
            padding: 0.5rem 1rem;
            min-width: 13%;
            border-top-left-radius: 0.5rem !important;
            border-bottom-left-radius: 0.5em !important;
        }

        /*區塊標題樣式*/
        h2 {
            color: black !important;
            font-weight: bolder !important;
        }

    </style>
</head>

<body>
<div id="header-page"></div>

<section class="ftco-section main-img">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-6 half p-5 ftco-animate">
                <h2 class="mb-3">基本會員資料</h2>
                <div class="row">
                    <div class="col-12">
                        <div class="form-group d-flex">
                            <h5 class="font-weight-bold text-justify pb-0 py-2 px-0" style="width: 60px;">帳號</h5>
                            <input id="userEmail" type="email" class="form-control" placeholder="電子郵件"
                                   style="background-color: lightgrey !important; cursor: default;" readonly>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group d-flex">
                            <h5 class="font-weight-bold text-justify pb-0 py-2 px-0" style="width: 60px;">姓名</h5>
                            <input id="userName" type="text" class="form-control" placeholder="姓名">
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group d-flex">
                            <h5 class="font-weight-bold text-justify pb-0 py-2 px-0" style="width: 60px;">性別</h5>
                            <input id="userGender" type="text" class="form-control" placeholder="性別"
                                   style="background-color: lightgrey !important; cursor: default;" readonly>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group d-flex">
                            <h5 class="font-weight-bold text-justify pb-0 py-2 px-0" style="width: 60px;">電話</h5>
                            <input id="userTel" type="tel" class="form-control" placeholder="聯絡電話">
                        </div>
                    </div>
                    <!--如果修改密碼，把editPassword清空，並移除readonly，顯示passwordCheckDiv-->
                    <div class="col-md-12">
                        <div class="form-group d-flex">
                            <h5 class="font-weight-bold text-justify pb-0 py-2 px-0" style="width: 60px;">密碼</h5>
                            <input id="editPassword" type="password" class="form-control" placeholder="密碼"
                                   style="background-color: lightgrey !important; cursor: default; user-select: none;"
                                   readonly>
                        </div>
                    </div>

                    <div id="passwordCheckDiv" class="col-md-12" style="display: none">
                        <div class="form-group d-flex">
                            <h5 class="font-weight-bold text-justify pb-0 py-2 px-0" style="width: 60px;">密碼確認</h5>
                            <input id="editPasswordCheck" type="password" class="form-control" placeholder="密碼確認">
                        </div>
                    </div>
                    <div id="editDiv" class="col-md-12">
                        <div class="form-group d-flex">
                            <a href="javascript:;" onclick="editButton()">修改密碼</a>
                        </div>
                    </div>
                    <div id="cancelDiv" class="col-md-12" style="display: none">
                        <div class="form-group d-flex">
                            <a href="javascript:;" onclick="cancelButton()">取消</a>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group d-flex">
                            <h5 class="font-weight-bold text-justify pb-0 py-2 px-0" style="width: 60px;">當前密碼</h5>
                            <input id="userOldPassword" type="password" class="form-control" placeholder="當前密碼">
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <button onclick="edit()" class="form-control btn btn-primary py-1 px-4">變更
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 頁腳 -->
<div id="footer-page"></div>


<!-- 頁面載入動畫 -->
<div id="ftco-loader" class="show fullscreen">
    <svg class="circular" width="48px" height="48px">
        <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/>
        <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
                stroke="#F96D00"/>
    </svg>
</div>


<script src="js/jquery.min.js"></script>
<script src="js/jquery-migrate-3.0.1.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.easing.1.3.js"></script>
<script src="js/jquery.waypoints.min.js"></script>
<script src="js/jquery.stellar.min.js"></script>
<script src="js/jquery.animateNumber.min.js"></script>
<script src="js/bootstrap-datepicker.js"></script>
<script src="js/jquery.timepicker.min.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script src="js/jquery.magnific-popup.min.js"></script>
<script src="js/scrollax.min.js"></script>
<script src="js/main.js"></script>
<script>
    <!-- 讀取頁首及頁腳 -->
    $("#header-page").load("/header", function () {
        // 取消非同步執行 讀取完 header 後再取得 title 名稱放入迷你導覽列
        $("#page-title").text($("title")[0].innerText);
    });
    $("#footer-page").load("/footer");
</script>
<script>
    function edit() {
        var name = $("#userName").val();
        var tel = $("#userTel").val();
        var editPasswd = $("#editPassword").val();
        var editPasswdCheck = $("#editPasswordCheck").val();
        var oldPasswd = $("#userOldPassword").val();
        console.log("會員Id: "+user.id);
        if (editPasswd != "" && editPasswdCheck == "") {//沒有修改密碼
            if (name == "" || tel == "" || oldPasswd == "") {
                alert("請填寫所有欄位!");
                return
            }
            $.ajax({
                type: "PUT",
                url: "/user/" + user.id,
                async: false,
                contentType: "application/json; charset=UTF-8",
                data:
                    JSON.stringify({
                        "name": name,
                        "password": oldPasswd,
                        "tel": tel
                    }),
                success: function (data) {
                    console.log(data);
                    alert(data);
                    init();
                }
            })
            console.log("沒有修改密碼")
            console.log(name);
            console.log(tel);
            console.log(editPasswd);
            console.log(editPasswdCheck);
            console.log(oldPasswd);

        } else if (editPasswd != "" && editPasswdCheck != "") {//有修改密碼
            if (name == "" || tel == "" || editPasswd == "" || editPasswdCheck == "" || oldPasswd == "") {
                alert("請填寫所有欄位!");
                return
            }
            if (editPasswd == editPasswdCheck) {
                $.ajax({
                    type: "PUT",
                    url: "/user/" + user.id,
                    async: false,
                    contentType: "application/json; charset=UTF-8",
                    data:
                        JSON.stringify({
                            "name": name,
                            "password": oldPasswd,
                            "tel": tel,
                            "editPassword" : editPasswd
                        }),
                    success: function (data) {
                        init();
                        console.log(data);
                        alert(data);
                    }
                })
            }else {
                alert("密碼不一致!");
            }
            console.log("有修改密碼");
            console.log(name);
            console.log(tel);
            console.log(editPasswd);
            console.log(editPasswdCheck);
            console.log(oldPasswd);
        } else {
            alert("請填寫所有欄位!");
        }
    }

    function editButton() {
        $("#editDiv").attr("style", "display: none")
        $("#cancelDiv").attr("style", "display: inline")
        $("#editPassword").val("");
        $("#editPassword").removeAttr("style");
        $("#editPassword").removeAttr("readonly");
        $("#passwordCheckDiv").val("");
        $("#passwordCheckDiv").attr("style", "display: inline")
    }

    function cancelButton() {
        $("#editDiv").attr("style", "display: inline")
        $("#cancelDiv").attr("style", "display: none")
        $("#editPasswordCheck").val("");
        $("#editPassword").val("****************");
        $("#editPassword").attr("style", "background-color: lightgrey !important; cursor: default; user-select: none;");
        $("#editPassword").attr("readonly", "");
        $("#passwordCheckDiv").attr("style", "display: none")
    }


</script>

</body>
</html>