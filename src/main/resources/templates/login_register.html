<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <title>會員登入</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <!-- 禁用官方樣式 使用 Bootstrap 自帶樣式
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    -->
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="css/jquery.timepicker.css">
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/style.css">
    <!-- 全域自訂CSS樣式 -->
    <link rel="stylesheet" href="css/_custom.css">
    <!--  自訂樣式  -->
    <style>
        /*按鈕樣式*/
        .btn.btn-primary {
            color: black !important;
            padding: 6px 20px;
            font-size: 1rem;
            letter-spacing: 1px;
            border: transparent !important;
            background: #fcd601 !important;
            opacity: 1;
        }

        /*按鈕樣式-滑鼠掠過*/
        .btn.btn-primary:hover {
            color: white !important;
            background: #ffa500 !important;
            opacity: 1;
        }

        /*註冊登入區輸入框、按鈕、下拉選單字體加大、邊角圓弧加大*/
        .form-group input,
        .form-group button,
        .form-group select {
            font-size: 20px !important;
            border-radius: 0.5rem;
        }

        /*ICON 鄰近輸入區邊角取消圓弧效果*/
        span + input, span + select {
            border-radius: 0 0.5rem 0.5rem 0 !important;
        }

        /*ICON 自訂樣式*/
        .fa-icon {
            color: black;
            background: lightgrey;
            text-align: center;
            padding: 0.5rem 1rem;
            min-width: 13%;
            border-top-left-radius: 0.5rem !important;
            border-bottom-left-radius: 0.5em !important;
        }

        /*區塊標題樣式*/
        h2 {
            color: black !important;
            font-weight: bolder !important;
        }

        /*垂直分隔線*/
        .overlay {
            border-left: 1px solid grey;
            height: 300px;
            margin-block: auto;
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            opacity: 1;
        }

        @media (min-width: 992px) {
            .overlay {
                width: 50%;
            }
        }
    </style>
</head>

<body>
<div id="header-page"></div>

<section class="ftco-section main-img">
    <div class="overlay"></div>
    <div class="container d-flex flex-wrap" style="max-width: 1200px;">
        <div class="col-md-12 col-lg-6 half p-5 ftco-animate">
            <h2 class="m-3">登入</h2>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-12">
                        <div class="form-group d-flex">
                            <span class="fa-icon"><i class="fa fa-envelope-o fa-2x"></i></span>
                            <input id="loginEmail" type="email" class="form-control" placeholder="電子郵件"
                                   onchange="judgeLoginEmail(this.id)">
                        </div>
                    </div>
                    <!-- Email 驗證訊息 -->
                    <!-- 登入欄位Email可用性驗證或非必要，暫時隱藏此功能 -->
                    <span id="loginPromptEmail" class="col-md-12 form-group"
                          style="display: none; position: relative !important; top: -0.5rem !important;"></span>
                    <div class="col-md-12">
                        <div class="form-group d-flex">
                            <span class="fa-icon"><i class="fa fa-key fa-2x"></i></span>
                            <input id="loginPassword" type="password" class="form-control" placeholder="密碼">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <button id="loginBtn" onclick="login()" class="form-control btn btn-primary py-1 px-4">
                                登入
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12 col-lg-6 half p-5 ftco-animate">
            <h2 id="registStatus" class="m-3">註冊</h2>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-12">
                        <div class="form-group d-flex">
                            <span class="fa-icon"><i class="fa fa-envelope-o fa-2x"></i></span>
                            <input id="emailAjax" type="email" class="form-control" placeholder="電子郵件"
                                   onchange="judgeRegisterEmail(this.id)" required/>
                        </div>
                    </div>
                    <!-- Email 驗證訊息 -->
                    <span id="promptEmail" class="col-md-12 form-group"
                          style="display: none; position: relative !important; top: -0.5rem !important;"></span>
                    <div class="col-md-12">
                        <div class="form-group d-flex">
                            <span class="fa-icon"><i class="fa fa-key fa-2x"></i></span>
                            <input id="passwordAjax" type="password" class="form-control" placeholder="密碼">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group d-flex">
                            <span class="fa-icon"><i class="fa fa-key fa-2x"></i></span>
                            <input id="passwordCheckAjax" type="password" class="form-control" placeholder="密碼確認">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group d-flex">
                            <span class="fa-icon"><i class="fa fa-user-o fa-2x"></i></span>
                            <input id="nameAjax" type="text" class="form-control" placeholder="姓名">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group d-flex">
                            <span class="fa-icon"><i class="fa fa-transgender fa-2x"></i></span>
                            <select id="genderAjax" class="form-control">
                                <option selected="selected">性別</option>
                                <option value="男">男</option>
                                <option value="女">女</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group d-flex">
                            <span class="fa-icon"><i class="fa fa-phone fa-2x"></i></span>
                            <input id="telAjax" type="tel" class="form-control" placeholder="聯絡電話">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <button id="registBtn" onclick="register()" class="form-control btn btn-primary py-1 px-4">
                                註冊
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 頁腳 -->
<div id="footer-page"></div>

<!-- 頁面載入動畫 -->
<div id="ftco-loader" class="show fullscreen">
    <svg class="circular" width="48px" height="48px">
        <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/>
        <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
                stroke="#F96D00"/>
    </svg>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/jquery-migrate-3.0.1.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.easing.1.3.js"></script>
<script src="js/jquery.waypoints.min.js"></script>
<script src="js/jquery.stellar.min.js"></script>
<script src="js/jquery.animateNumber.min.js"></script>
<script src="js/bootstrap-datepicker.js"></script>
<script src="js/jquery.timepicker.min.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script src="js/jquery.magnific-popup.min.js"></script>
<script src="js/scrollax.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
<script src="js/main.js"></script>
<script>
    <!-- 讀取頁首及頁腳 -->
    $("#header-page").load("/header", function () {
        // 取消非同步執行 讀取完 header 後再取得 title 名稱放入迷你導覽列
        $("#page-title").text($("title")[0].innerText);
    });
    $("#footer-page").load("/footer");
</script>
<script type="text/javascript">
    function judgeRegisterEmail(email) {

        var xhr = new XMLHttpRequest();
        xhr.addEventListener('load', function () {
            if (xhr.status == 200) {
                // 移除 display: none
                document.getElementById("promptEmail").style.removeProperty("display");
                document.getElementById("promptEmail").innerHTML = "該Email已被註冊";
                document.getElementById("promptEmail").style.color = "red";
                // 相對位置調整
                document.getElementById("promptEmail").style.position = "relative";
                document.getElementById("promptEmail").style.top = "-0.5rem";
            } else {
                document.getElementById("promptEmail").style.display = "none";
            }
        })
        xhr.open('get', "/user/registed?email=" + document.getElementById(email).value);
        xhr.send();
    }

    // 登入欄位Email可用性驗證或非必要，暫時隱藏此功能
    function judgeLoginEmail(email) {
        /*

        var xhr = new XMLHttpRequest();
        xhr.addEventListener('load', function () {
            if (xhr.status == 404 && document.getElementById(email).value != "") {
                // 移除 display: none
                document.getElementById("loginPromptEmail").style.removeProperty("display");
                document.getElementById("loginPromptEmail").style.color = "red";
                document.getElementById("loginPromptEmail").innerHTML = "該Email查無註冊資料";
                // 相對位置調整
                document.getElementById("loginPromptEmail").style.position = "relative";
                document.getElementById("loginPromptEmail").style.top = "-0.5rem";
            } else {
                document.getElementById("loginPromptEmail").style.display = "none"
            }
        })
        xhr.open('get', "http://localhost:8080/user/registed?email=" + document.getElementById(email).value);
        xhr.send();

        */
    }

    function login() {
        var emailAjax = document.getElementById("loginEmail").value
        var passwordAjax = document.getElementById("loginPassword").value
        if (emailAjax == "" || passwordAjax == "") {
            alert("登入所有資料必須填寫")
            return
        }
        var account = {
            email: emailAjax,
            password: passwordAjax,
        }
        var xhr = new XMLHttpRequest();
        xhr.addEventListener('load', function () {

            if (xhr.status == 200) {
                alert("登入成功")
                console.log(xhr.response)
                window.location.replace("/user_management");

                // document.getElementById("registStatus").innerHTML="<div style='color: green'>註冊成功請登入";
            } else if (xhr.status == 400) {
                alert("登入失敗 帳號或密碼輸入錯誤 ")
                // document.getElementById("registStatus").innerHTML="<div style='color: red'>註冊失敗";
            }

        })
        xhr.open('post', '/user/login', true);
        xhr.setRequestHeader('Content-type', 'application/json');
        var data = JSON.stringify(account);
        xhr.send(data);
    }

    function register() {
        var emailAjax = document.getElementById("emailAjax").value
        var passwordAjax = document.getElementById("passwordAjax").value
        var passwordCheckAjax = document.getElementById("passwordCheckAjax").value
        var nameAjax = document.getElementById("nameAjax").value
        var telAjax = document.getElementById("telAjax").value
        var genderAjax = document.getElementById("genderAjax").value
        if (emailAjax == "" || passwordAjax == "" || passwordCheckAjax == "" || nameAjax == "" || telAjax == "" || genderAjax == "性別") {
            alert("註冊所有資料必須填寫");
            return
        }else if (passwordAjax != passwordCheckAjax) {
            alert("密碼不一致");
            return
        }

        var account = {
            email: emailAjax,
            password: passwordAjax,
            name: nameAjax,
            tel: telAjax,
            gender: genderAjax
        }

        var xhr = new XMLHttpRequest();
        xhr.addEventListener('load', function () {

            if (xhr.status == 201) {
                document.getElementById("emailAjax").value = ""
                document.getElementById("passwordCheckAjax").value = ""
                document.getElementById("passwordAjax").value = ""
                document.getElementById("nameAjax").value = ""
                document.getElementById("telAjax").value = ""
                document.getElementById("genderAjax").value = "性別";
                document.getElementById("promptEmail").innerText = ""
                alert("註冊成功請登入")

                // document.getElementById("registStatus").innerHTML="<div style='color: green'>註冊成功請登入";
            } else {
                alert("註冊失敗")
                // document.getElementById("registStatus").innerHTML="<div style='color: red'>註冊失敗";
            }

        })
        xhr.open('post', '/user/register', true);
        xhr.setRequestHeader('Content-type', 'application/json');
        var data = JSON.stringify(account);
        xhr.send(data);
    }
</script>
</body>
</html>